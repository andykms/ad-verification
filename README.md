# Проект система управления объявлениями для модерации

## Запуск

Перейдите в корневую папку и введите в терминале
`docker compose up`

Сайт будет доступен по
`http://localhost`

Если не получается запустить докер:

- перейдите в терминале папку с сервером`cd tech-int3-server`
- Затем запустите сервер командой `npm run start`
- Затем перейдите в папку с фронтендом из папки сервера `cd ../frontend`
- И запустите фронтенд командой
`npm run dev`
- Сайт будет доступен по `localhost:5173`

## Стек проекта

React, TypeScript, React-Router, Redux, Vite, Docker, nginx.

## Структура

В папке `src`

/api - функции для работы с API

/components - компоненты UI.

/features - слайсы Redux и мидлвары redux-thunk для работы с API.

/hooks - хуки (для работы с фильтрами, localStorage).

/pages - компоненты страниц (просто отображают данные из презентеров).

/presenters - компоненты презентеры (соединяют данные хранилища со страницами, отправляют экшены).

/store - хранилище Redux.

/styles - стили (подключение шрифтов, глобальные стили, переменные).

/types - типы данных, используемых для приложения и для API.

/utils - утилитарные функции.

/App.tsx - Роуты.

## Слайсы

Реализовано три слайса:

- Объявления (features/ads)

В thunk реализованы функции для получения нескольких объявлений по фильтрам, одного объявления по id, 
отправка запроса на одобрение по id, на отклонение по id, причине и комментарию, на доработку, также по id, причине и комментарию.
Также реализованы функции для отправки нескольких заявок на одобрение и нескольких заявок на отклонение (используются при выборе нескольких объявлений).

- Фильтры (features/filters)

Фильтры получают query параметры при инициализации слайса. Слайс позволяет изменять query параметры по редьюсерам, которые после изменения синхронизируются с URL Params.

- Статистика (features/stats)

В thunk помимо получения каждого параметра по отдельности есть возможность получить все сразу при помощи fetchAllStats, которая применяет Promise.all для одновременного запроса всех статистик.

## Презентеры

- Объявления (presenters/AdsPresenter)

Для удобной читаемости кода получения фильтров и их реагирование на изменение значений, получение фильтров и объявлений по ним вынесен в отдельный хук `useFilters` (/hooks/useFilters).

- Текущее объявление (presenters/ItemPresenters)

Для переноса на следующую и предыдущие страницы необходимо получить блок объявлений, с которых произошел редирект. 
В ином случае, если на текущее объявление зашли по прямой ссылке, мы не можем получить следующий и предыдущие объявления, так как в таком бы случае пришлось делать лишние запросы к API, чтобы получить тот пул (это те объявления, которые отображаются  в /list по 10 штук) объявлений, где содержится текущее объявление. Поэтому ищем следующее объявление и предыдущее по позиции текущего объявление в пуле. Если пул заканчивается (текущее на последней позиции в пуле), то перебрасываем на следующую страницу. 

Для удобной читаемости кода, получение условий отображения кнопок на следующее и предыдущее объявления (если объявление на самом первой позиции, то нельзя попасть на предыдущее, так как его просто нет, поэтому не надо отображать кнопку назад, с самым последним объявлением аналогично) вынесено в отдельный хук useBlockNavigation (hooks/useBlockNavigation).

- Статистика (presenters/StatsPresenter)


Тут также реализована синхронизация с url params, но уже в слайсе stats, так как параметров немного.

Получаем статистику согласно фильтрам и передаем их в отображение StatsPage.

- Главная страница (presenters/MainPresenter)

Тут получаем модератора и отображаем его свойства в MainPage.

- Настройки (pages/SettingsPage)

Поскольку в настройках мы получаем только тему из localStorage, вместо презентера сразу страница. 

Для получения текущей темы используется хук useLocalStorage (hooks/useLocalStorage).

Переключение темы осуществляется с помощью добавления класса .dark в body при тёмной теме, и удаления этого класса при светлой. 

в .dark прописаны новые значения для CSS переменных, характерных для темных тем.


